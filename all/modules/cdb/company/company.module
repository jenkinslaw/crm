<?php
/**
 * @file
 * Main file to hold Copany Domain specific hook code.
 */

require_once 'company.features.inc';
require_once 'includes/Company.inc';
require_once 'includes/CompanyEntityForm.inc';


/**
 * Implements hook_form_alter().
 */
function company_form_alter(&$form, &$form_state, $form_id) {
  $company_form = new CompanyEntityForm($form);
  $company_form->hookForm();
  if ($form_id == 'views_exposed_form' && $form['#action'] == '/company/multi-search') {
    $form['company_name']['#type'] = 'textarea';
  }
}

/**
 * Implements hook_permission().
 */
function company_permission() {
  $perms = array(
    'company add' => array(
      'title' => 'Add New Company',
      'description' => 'Users with this permission may add new Company records to the database.',
    ),
    'company view' => array(
      'title' => 'View a Company',
      'description' => 'Users with this permission may view Company records in the database.',
    ),
  );
  return $perms;
}

/**
 * Implements hook_menu().
 */
function company_menu() {
  $items['company/add'] = array(
    'title' => 'Add New Company',
    'description' => 'The form for adding a new Company.',
    'page callback' => 'company_add_new_form',
    'access arguments' => array('company add'),
  );

  $items['company/view/%'] = array(
    'title' => 'View Company',
    'description' => 'View a Company page.',
    'page callback' => 'company_view_page',
    'access arguments' => array('company view'),
    'page arguments' => array(2),
  );
  return $items;
}

/**
 * A wrapper for eck__entity__add().
 */
function company_add_new_form() {
  $form = eck__entity__add('company', 'company');
  return drupal_render($form);
}

/**
 * Wrapper for eck__entity__view().
 */
function company_view_page($id) {
  $company = eck__entity__view('company', 'company', $id);
  $company_page = drupal_render($company);

  return $company_page;
}
